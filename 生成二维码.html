<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ… ç•ªèŒ„ç‹å›½ - äºŒç»´ç ç”Ÿæˆå™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #FEFBF5, #FFF4E6);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            width: 100%;
            background: white;
            border-radius: 24px;
            padding: 48px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            text-align: center;
        }

        h1 {
            font-size: 36px;
            color: #FF6347;
            margin-bottom: 16px;
        }

        .subtitle {
            font-size: 18px;
            color: #666;
            margin-bottom: 32px;
        }

        .step {
            text-align: left;
            background: #f9f9f9;
            padding: 24px;
            border-radius: 16px;
            margin-bottom: 24px;
        }

        .step-number {
            display: inline-block;
            width: 32px;
            height: 32px;
            background: #FF6347;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 32px;
            font-weight: bold;
            margin-right: 12px;
        }

        .step-title {
            font-size: 20px;
            font-weight: bold;
            color: #333;
            margin-bottom: 12px;
        }

        .step-content {
            color: #666;
            line-height: 1.8;
            margin-left: 44px;
        }

        .input-group {
            margin: 24px 0;
        }

        input {
            width: 100%;
            padding: 16px;
            font-size: 16px;
            border: 2px solid #ddd;
            border-radius: 12px;
            margin-top: 8px;
        }

        input:focus {
            outline: none;
            border-color: #FF6347;
        }

        button {
            background: #FF6347;
            color: white;
            border: none;
            padding: 16px 48px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 12px;
            cursor: pointer;
            margin: 8px;
            transition: all 0.3s;
        }

        button:hover {
            background: #FF4500;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255,99,71,0.3);
        }

        .qr-container {
            margin: 32px 0;
            padding: 24px;
            background: #f9f9f9;
            border-radius: 16px;
            display: none;
        }

        .qr-container.show {
            display: block;
        }

        #qrcode {
            display: inline-block;
            padding: 16px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .url-display {
            margin-top: 16px;
            padding: 16px;
            background: white;
            border-radius: 12px;
            font-family: 'Courier New', monospace;
            color: #FF6347;
            font-weight: bold;
            word-break: break-all;
        }

        .alert {
            background: #FEF3C7;
            border-left: 4px solid #F59E0B;
            padding: 16px;
            border-radius: 8px;
            margin: 24px 0;
            text-align: left;
        }

        .alert-title {
            font-weight: bold;
            color: #92400E;
            margin-bottom: 8px;
        }

        .auto-detect {
            background: #E0F2FE;
            padding: 16px;
            border-radius: 12px;
            margin: 24px 0;
        }

        .ip-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }

        .ip-item {
            background: white;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }

        .ip-item:hover {
            border-color: #FF6347;
            transform: translateY(-2px);
        }

        .ip-item.selected {
            border-color: #FF6347;
            background: #FFF4E6;
        }

        code {
            background: #f0f0f0;
            padding: 4px 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            color: #FF6347;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ… ç•ªèŒ„ç‹å›½äºŒç»´ç ç”Ÿæˆå™¨</h1>
        <p class="subtitle">è®©æ‰‹æœºæ‰«ç å³å¯è®¿é—®ç½‘ç«™</p>

        <div class="step">
            <div class="step-title">
                <span class="step-number">1</span>
                å¯åŠ¨æœ¬åœ°æœåŠ¡å™¨
            </div>
            <div class="step-content">
                <p>åŒå‡»è¿è¡Œ <code>å¯åŠ¨æœåŠ¡å™¨.bat</code> æ–‡ä»¶</p>
                <p>æˆ–è€…åœ¨å½“å‰æ–‡ä»¶å¤¹æ‰“å¼€å‘½ä»¤è¡Œï¼Œè¿è¡Œï¼š</p>
                <p><code>python -m http.server 8080</code></p>
            </div>
        </div>

        <div class="step">
            <div class="step-title">
                <span class="step-number">2</span>
                è·å–ç”µè„‘IPåœ°å€
            </div>
            <div class="step-content">
                <button onclick="autoDetectIP()">ğŸ” è‡ªåŠ¨æ£€æµ‹IPåœ°å€</button>
                <button onclick="showManualInput()">âœï¸ æ‰‹åŠ¨è¾“å…¥</button>
                
                <div id="autoDetect" class="auto-detect" style="display: none;">
                    <p style="margin-bottom: 12px; font-weight: bold;">æ£€æµ‹åˆ°çš„IPåœ°å€ï¼š</p>
                    <div class="ip-list" id="ipList"></div>
                </div>

                <div id="manualInput" style="display: none; margin-top: 16px;">
                    <p style="margin-bottom: 8px;">åœ¨å‘½ä»¤è¡Œè¾“å…¥ <code>ipconfig</code> æŸ¥çœ‹IPåœ°å€</p>
                    <p style="margin-bottom: 8px; color: #999; font-size: 14px;">
                        é€šå¸¸æ˜¯ 192.168.x.x æˆ– 10.0.x.x æ ¼å¼
                    </p>
                    <div class="input-group">
                        <label>è¾“å…¥ä½ çš„ç”µè„‘IPåœ°å€ï¼š</label>
                        <input type="text" id="ipInput" placeholder="ä¾‹å¦‚ï¼š192.168.1.100">
                    </div>
                </div>
            </div>
        </div>

        <div class="step">
            <div class="step-title">
                <span class="step-number">3</span>
                é€‰æ‹©ç‰ˆæœ¬
            </div>
            <div class="step-content">
                <div class="input-group">
                    <label style="font-weight: bold;">é€‰æ‹©è¦è®¿é—®çš„ç‰ˆæœ¬ï¼š</label>
                    <select id="versionSelect" style="font-size: 16px; padding: 12px;">
                        <option value="index-social.html" selected>ğŸŒŸ ç¤¾äº¤ç‰ˆï¼ˆæœ€æ–° - ç…§ç‰‡åˆ†äº«+è¯„è®ºè®¨è®ºï¼‰</option>
                        <option value="index-mobile-enhanced.html">ğŸ“¸ å¢å¼ºç‰ˆï¼ˆæ‹ç…§ä¸Šä¼ +è¯„ä»·æŠ¥å‘Šï¼‰</option>
                        <option value="index-standalone.html">ğŸ“ åŸºç¡€ç‰ˆï¼ˆæ•°æ®è®°å½•ï¼‰</option>
                    </select>
                    <p style="margin-top: 8px; color: #666; font-size: 14px;">
                        ğŸ’¡ ç¤¾äº¤ç‰ˆæ”¯æŒå­¦ç”Ÿäº’åŠ¨ã€æ•™å¸ˆè¯„è¯­ã€ä¸€é”®å¯¼å‡ºï¼
                    </p>
                </div>
            </div>
        </div>

        <div class="step">
            <div class="step-title">
                <span class="step-number">4</span>
                ç”ŸæˆäºŒç»´ç 
            </div>
            <div class="step-content">
                <button onclick="generateQRCode()">âœ¨ ç”ŸæˆäºŒç»´ç </button>
            </div>
        </div>

        <div class="qr-container" id="qrContainer">
            <h3 style="margin-bottom: 16px; color: #333;">æ‰«æä¸‹æ–¹äºŒç»´ç è®¿é—®</h3>
            <div id="qrcode"></div>
            <div class="url-display" id="urlDisplay"></div>
            <div class="alert" style="margin-top: 24px;">
                <div class="alert-title">ğŸ“± ä½¿ç”¨è¯´æ˜</div>
                <p>1. ç¡®ä¿æ‰‹æœºå’Œç”µè„‘è¿æ¥åŒä¸€ä¸ªWiFi</p>
                <p>2. ä½¿ç”¨å¾®ä¿¡/æµè§ˆå™¨æ‰«æä¸Šæ–¹äºŒç»´ç </p>
                <p>3. å¦‚æœæ— æ³•è®¿é—®ï¼Œæ£€æŸ¥é˜²ç«å¢™è®¾ç½®</p>
            </div>
        </div>

        <div class="alert">
            <div class="alert-title">ğŸ’¡ æç¤º</div>
            <p><strong>é‡è¦ï¼š</strong>æ‰‹æœºå’Œç”µè„‘å¿…é¡»è¿æ¥åˆ°<strong>åŒä¸€ä¸ªWiFiç½‘ç»œ</strong></p>
            <p>å¦‚æœæ‰«ç åæ— æ³•è®¿é—®ï¼Œè¯·å…³é—­Windowsé˜²ç«å¢™æˆ–å…è®¸Pythoné€šè¿‡é˜²ç«å¢™</p>
        </div>
    </div>

    <script>
        let selectedIP = null;

        // è‡ªåŠ¨æ£€æµ‹IP
        async function autoDetectIP() {
            document.getElementById('autoDetect').style.display = 'block';
            document.getElementById('manualInput').style.display = 'none';
            
            const ipList = document.getElementById('ipList');
            ipList.innerHTML = '<p>æ­£åœ¨æ£€æµ‹...</p>';

            try {
                // å°è¯•é€šè¿‡WebRTCè·å–æœ¬åœ°IP
                const ips = await getLocalIPs();
                
                if (ips.length === 0) {
                    ipList.innerHTML = `
                        <p style="color: #F59E0B;">æ— æ³•è‡ªåŠ¨æ£€æµ‹IPåœ°å€</p>
                        <p style="font-size: 14px; margin-top: 8px;">è¯·ç‚¹å‡»"æ‰‹åŠ¨è¾“å…¥"æŒ‰é’®</p>
                    `;
                    return;
                }

                ipList.innerHTML = '';
                ips.forEach(ip => {
                    const div = document.createElement('div');
                    div.className = 'ip-item';
                    div.innerHTML = `
                        <div style="font-weight: bold; margin-bottom: 4px;">${ip}</div>
                        <div style="font-size: 12px; color: #666;">ç‚¹å‡»é€‰æ‹©</div>
                    `;
                    div.onclick = () => {
                        document.querySelectorAll('.ip-item').forEach(item => {
                            item.classList.remove('selected');
                        });
                        div.classList.add('selected');
                        selectedIP = ip;
                    };
                    ipList.appendChild(div);
                });

                // è‡ªåŠ¨é€‰æ‹©ç¬¬ä¸€ä¸ª
                if (ips.length > 0) {
                    selectedIP = ips[0];
                    ipList.firstChild.classList.add('selected');
                }
            } catch (error) {
                ipList.innerHTML = `
                    <p style="color: #F59E0B;">æ£€æµ‹å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨è¾“å…¥</p>
                `;
            }
        }

        // è·å–æœ¬åœ°IPåœ°å€
        function getLocalIPs() {
            return new Promise((resolve) => {
                const ips = [];
                const RTCPeerConnection = window.RTCPeerConnection || 
                                        window.mozRTCPeerConnection || 
                                        window.webkitRTCPeerConnection;
                
                if (!RTCPeerConnection) {
                    resolve(ips);
                    return;
                }

                const pc = new RTCPeerConnection({iceServers: []});
                pc.createDataChannel('');
                
                pc.createOffer().then(offer => pc.setLocalDescription(offer));
                
                pc.onicecandidate = (ice) => {
                    if (!ice || !ice.candidate || !ice.candidate.candidate) {
                        pc.close();
                        resolve([...new Set(ips)]);
                        return;
                    }
                    
                    const parts = ice.candidate.candidate.split(' ');
                    const ip = parts[4];
                    
                    if (ip && ip.match(/^(\d{1,3}\.){3}\d{1,3}$/) && 
                        !ip.startsWith('0.') && 
                        !ip.startsWith('127.')) {
                        ips.push(ip);
                    }
                };

                setTimeout(() => {
                    pc.close();
                    resolve([...new Set(ips)]);
                }, 2000);
            });
        }

        // æ˜¾ç¤ºæ‰‹åŠ¨è¾“å…¥
        function showManualInput() {
            document.getElementById('manualInput').style.display = 'block';
            document.getElementById('autoDetect').style.display = 'none';
        }

        // ç”ŸæˆäºŒç»´ç 
        function generateQRCode() {
            let ip = selectedIP || document.getElementById('ipInput').value.trim();
            
            if (!ip) {
                alert('âš ï¸ è¯·å…ˆé€‰æ‹©æˆ–è¾“å…¥IPåœ°å€ï¼');
                return;
            }

            // éªŒè¯IPæ ¼å¼
            if (!ip.match(/^(\d{1,3}\.){3}\d{1,3}$/)) {
                alert('âš ï¸ IPåœ°å€æ ¼å¼ä¸æ­£ç¡®ï¼\nåº”è¯¥ç±»ä¼¼ï¼š192.168.1.100');
                return;
            }

            const port = '8080';
            const version = document.getElementById('versionSelect').value;
            const url = `http://${ip}:${port}/${version}`;

            // æ˜¾ç¤ºå®¹å™¨
            document.getElementById('qrContainer').classList.add('show');
            document.getElementById('urlDisplay').textContent = url;

            // æ¸…ç©ºä¹‹å‰çš„äºŒç»´ç 
            document.getElementById('qrcode').innerHTML = '';

            // ç”ŸæˆäºŒç»´ç 
            generateQR(url);

            // æ»šåŠ¨åˆ°äºŒç»´ç 
            document.getElementById('qrContainer').scrollIntoView({ 
                behavior: 'smooth', 
                block: 'center' 
            });
        }

        // ç”ŸæˆäºŒç»´ç ï¼ˆä½¿ç”¨çº¯JSå®ç°ï¼Œæ— éœ€å¤–éƒ¨åº“ï¼‰
        function generateQR(text) {
            const qrContainer = document.getElementById('qrcode');
            
            // ä½¿ç”¨Google Chart APIç”ŸæˆäºŒç»´ç 
            const img = document.createElement('img');
            const size = 300;
            img.src = `https://api.qrserver.com/v1/create-qr-code/?size=${size}x${size}&data=${encodeURIComponent(text)}`;
            img.style.width = size + 'px';
            img.style.height = size + 'px';
            img.alt = 'QR Code';
            
            // å¦‚æœæ— æ³•åŠ è½½åœ¨çº¿äºŒç»´ç ï¼Œæ˜¾ç¤ºçº¯æ–‡æœ¬æç¤º
            img.onerror = function() {
                qrContainer.innerHTML = `
                    <div style="padding: 40px; background: #FEF3C7; border-radius: 12px;">
                        <p style="font-size: 18px; margin-bottom: 16px; color: #92400E;">
                            âš ï¸ æ— æ³•ç”ŸæˆäºŒç»´ç å›¾ç‰‡
                        </p>
                        <p style="margin-bottom: 16px; color: #666;">
                            è¯·åœ¨æ‰‹æœºæµè§ˆå™¨ä¸­ç›´æ¥è¾“å…¥ä»¥ä¸‹åœ°å€ï¼š
                        </p>
                        <div style="background: white; padding: 16px; border-radius: 8px; font-family: monospace; word-break: break-all;">
                            ${text}
                        </div>
                        <p style="margin-top: 16px; font-size: 14px; color: #666;">
                            æˆ–ä½¿ç”¨å…¶ä»–äºŒç»´ç ç”Ÿæˆå·¥å…·ç”Ÿæˆè¯¥ç½‘å€çš„äºŒç»´ç 
                        </p>
                    </div>
                `;
            };
            
            qrContainer.appendChild(img);
        }

        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºä½¿ç”¨æç¤º
        window.onload = function() {
            // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ åˆå§‹åŒ–é€»è¾‘
        };
    </script>
</body>
</html>
